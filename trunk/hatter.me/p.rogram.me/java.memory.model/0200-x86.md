!!EXPLAIN
微架构之x86

`x86`是一个指令集架构家族，最早由英特尔在`Intel 8086` CPU上开发出来。该系列较早期的处理器名称是以数字来表示`80x86`。由于以`86`作为结尾，包括`Intel 8086`、`80186`、`80286`、`80386`以及`80486`，因此其架构被称为`x86`。


!!#x86x64# 发展历程

`x86`架构于`1978年`推出的`Intel 8086`中央处理器中首度出现，它是从`Intel 8008`处理器中发展而来的，而`8008`则是发展自`Intel 4004`的。`8086`在三年后为`IBM PC`所选用，之后x86便成为了个人计算机的标准平台，成为了历来最成功的CPU架构。

`8086`是`16位`处理器；直到`1985年` `32位`的`80386`的开发，这个架构都维持是`16位`。接着一系列的处理器表示了`32位`架构的细微改进，推出了数种的扩充，直到`2003年` `AMD`对于这个架构发展了`64位`的扩充，并命名为`AMD64`。后来英特尔也推出了与之兼容的处理器，并命名为`Intel 64`。两者一般被统称为`x86-64`或`x64`，开创了`x86`的`64位`时代。

_英特尔在`1990年代`就与惠普合作提出了一种用在安腾系列处理器中的独立的`64位`架构，这种架构被称为`IA-64`。`IA-64`是一种崭新的系统，和x86架构完全没有相似性；不应该把它与`x86-64`或`x64`弄混。_


!!#cache# CPU缓存

#### `Core 2` `L1 Cache`(容量`32K`，`8路`，缓存线`64字节`):
<img src="/java.memory.model/x86/core2_l1_cache.png"/>

_图片引用自：[!](http://duartes.org/gustavo/blog/post/intel-cpu-caches)_

<br>
在`Linux`下查看`缓存`的信息：
%%% wikiTable class=table___table-bordered style=width:800px;
||*2 `cat /sys/devices/system/cpu/cpu{N}/cache/index{N}/{?}` |
|| level | `1`,`2`,`3` 分别代表 `L1`,`L2`,`L3` |
|| type | `Data`或`Instruction`，只有`L1`才有`Instruction` |
|| coherency_line_size | `缓存线`(`Cache Line`)大小 |
|| number_of_sets | 是多少行 |
|| ways_of_associativity | 一共有多少路 |
|| size | `32K`缓存大小 (`== coherency_line_size * number_of_sets * ways_of_associativity`) |
|| shared_cpu_list | 在哪几个“`CPU`”之间共享，逗号分隔方式枚举 |
|| shared_cpu_map | 在哪几个“`CPU`”之间共享，十六进制表示 |
%%%


!!#mesi# 缓存一致性

缓存一致性(`MESI`, `Modified Exclusive Shared Invalid`)协议，也称为伊利诺伊协议(`Illinois protocol`，由伊利诺伊大学香槟[`Urbana-Champaign`]分校开发)，被广泛用于缓存一致性和内存一致性。是支持缓存回写的最通用的一种协议。

在`MESI`协议中，每个缓存行有4个状态，可用2个bit表示，它们分别是：

%%% wikiTable class=table___table-bordered style=width:700px;
|| 状态 || 描述 ||
|| M(Modified) | 这行数据有效，数据被修改了，和内存中的数据不一致，数据只存在于本`Cache`中。 |
|| E(Exclusive) | 这行数据有效，数据和内存中的数据一致，数据只存在于本`Cache`中。 |
|| S(Shared) | 这行数据有效，数据和内存中的数据一致，数据存在于很多`Cache`中。 |
|| I(Invalid) | 这行数据无效 |
%%%

`MESI`状态迁移图：
<img src="mesi.jpg"/>

_其中`Intel`使用[!`MESIF`](http://en.wikipedia.org/wiki/MESIF_protocol)，`AMD`使用[!`MOESI`](http://en.wikipedia.org/wiki/MOESI_protocol)_


!!#falsesharing# 伪共享:::伪共享(False Sharing)



!!#qpi# QPI



!!#reordering# 指令重排



!!#liushuixian# 流水线技术




